<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FDFBF7">
    <title>POMELLI | The Estate Archive (Est. 1922)</title>
    
    <!-- === LUXURY TYPOGRAPHY SUITE === -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600&family=Italianno&family=Monsieur+La+Doulaise&family=Playfair+Display:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    
    <!-- FONT AWESOME ICONS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* ==========================================================================
           1. THE ESTATE DESIGN SYSTEM (CSS VARIABLES)
           ========================================================================== */
        :root {
            /* Palette: 'Velvet & Parchment' */
            --cherry-deep: #5e0b15;
            --cherry-bright: #8a1c28;
            --walnut-ink: #1f1a18;
            --cream-paper: #FDFBF7;
            --cream-shadow: #eceae4;
            --gold-antique: #b08d55;
            --gold-leaf: #D4AF37;
            
            /* Textures */
            --paper-grain: url("https://www.transparenttextures.com/patterns/cream-paper.png");
            
            /* Typography */
            --f-display: 'Cinzel', serif;
            --f-body: 'Cormorant Garamond', serif;
            --f-script: 'Monsieur La Doulaise', cursive;
            --f-ital: 'Playfair Display', serif;
        }

        /* --- GLOBAL RESETS --- */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html { scroll-behavior: smooth; height: 100%; }
        
        body {
            background-color: var(--cream-paper);
            background-image: var(--paper-grain);
            color: var(--walnut-ink);
            font-family: var(--f-body);
            overflow-x: hidden;
            font-size: 18px;
            padding-bottom: 80px; /* Space for Mobile Navs */
        }

        h1, h2, h3, h4 { font-weight: normal; }
        img { display: block; width: 100%; object-fit: cover; }
        
        /* Smooth Fade In */
        .fade-in { animation: fadeIn 1s ease-in forwards; }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

        /* ==========================================================================
           2. THE IRON GATES (Preloader / Entrance)
           *Fixes Mobile Video Autoplay by forcing interaction*
           ========================================================================== */
        #estate-gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #110d0c; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 1.2s cubic-bezier(0.7, 0, 0.3, 1);
        }
        
        #estate-gate.open { transform: translateY(-100%); pointer-events: none; }

        .gate-logo { 
            width: 150px; opacity: 0; 
            animation: floatUp 1s 0.5s forwards; 
            filter: invert(1); margin-bottom: 30px;
        }

        .enter-btn {
            background: transparent; border: 1px solid var(--gold-leaf);
            color: var(--gold-leaf); font-family: var(--f-display);
            padding: 15px 40px; font-size: 1rem; letter-spacing: 3px;
            text-transform: uppercase; cursor: pointer;
            opacity: 0; animation: floatUp 1s 1s forwards;
            transition: 0.3s;
        }
        .enter-btn:active { background: var(--gold-leaf); color: #000; }

        @keyframes floatUp { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }


        /* ==========================================================================
           3. THE MANOR NAVIGATION (Sticky)
           ========================================================================== */
        .manor-nav {
            position: fixed; top: 0; left: 0; width: 100%; height: 75px;
            background: rgba(253, 251, 247, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.06);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; z-index: 5000;
            transition: all 0.4s;
        }

        /* LOGO LOGIC - SCALING PERFECTLY */
        .logo-wrap { 
            height: 100%; display: flex; align-items: center; justify-content: center; 
            flex-grow: 1; /* Centered */
        }
        .nav-logo { 
            height: 48px; width: auto; 
            mix-blend-mode: multiply; 
        }

        .nav-action {
            flex: 0 0 40px; font-size: 1.4rem; color: var(--walnut-ink);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }

        .cart-wrapper { position: relative; }
        .cart-badge {
            position: absolute; top: -5px; right: -5px;
            background-color: var(--cherry-deep); color: white;
            font-size: 0.65rem; width: 18px; height: 18px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: 0.3s;
        }
        .cart-badge.active { opacity: 1; }


        /* ==========================================================================
           4. CINEMATIC HEADER (The Hook)
           ========================================================================== */
        .cinema-frame {
            position: relative; height: 60vh; width: 100%;
            margin-top: 75px; /* Offset fixed header */
            overflow: hidden; 
            border-radius: 0 0 30px 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .cinema-video {
            width: 100%; height: 100%; object-fit: cover;
            filter: brightness(0.7) sepia(0.2);
            transform: scale(1.1); /* Zoom for slow parallax feeling */
        }

        .cinema-overlay {
            position: absolute; bottom: 40px; left: 0; width: 100%;
            text-align: center; color: white; z-index: 10;
        }

        .cinema-script {
            font-family: var(--f-script); color: var(--gold-leaf);
            font-size: 3rem; line-height: 0.5; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .cinema-title {
            font-family: var(--f-display); font-size: 2.2rem;
            text-transform: uppercase; margin-top: 15px; letter-spacing: 2px;
            text-shadow: 0 2px 20px rgba(0,0,0,0.8);
        }


        /* ==========================================================================
           5. NAVIGATION TABS (Interactive)
           ========================================================================== */
        .tab-scroller {
            position: sticky; top: 75px; background: var(--cream-paper);
            z-index: 4000; padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.05);
            white-space: nowrap; overflow-x: auto;
            -ms-overflow-style: none; scrollbar-width: none; /* Hide scrollbars */
        }
        .tab-scroller::-webkit-scrollbar { display: none; }

        .tab-track { display: inline-flex; padding: 0 20px; gap: 15px; }

        .tab-btn {
            background: #EEEBE2; border: 1px solid transparent;
            padding: 10px 22px; border-radius: 50px;
            font-family: var(--f-display); font-size: 0.8rem; letter-spacing: 1px;
            color: #666; transition: 0.3s;
        }

        .tab-btn.active {
            background: var(--walnut-ink); color: var(--gold-leaf);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }


        /* ==========================================================================
           6. CONTENT SECTIONS (The Showroom)
           ========================================================================== */
        .section-view { 
            display: none; 
            padding: 25px 20px; 
            min-height: 50vh;
        }
        
        .section-view.active { 
            display: block; 
            animation: riseUp 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        @keyframes riseUp { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }

        /* PRODUCT CARDS */
        .estate-card {
            background: white; border-radius: 12px;
            margin-bottom: 40px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.06);
            overflow: hidden; border: 1px solid rgba(0,0,0,0.03);
            position: relative;
        }

        /* Easter Egg: Card lifts on touch */
        .estate-card:active { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(0,0,0,0.1); }

        .card-img-frame { 
            height: 350px; position: relative; overflow: hidden; 
        }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: 1s; }
        
        /* Easter Egg: Zoom image slightly constantly */
        .card-img { animation: slowPan 20s infinite alternate; }
        @keyframes slowPan { from {transform:scale(1);} to {transform:scale(1.1);} }

        .price-badge {
            position: absolute; top: 15px; right: 15px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(5px);
            padding: 8px 16px; border-radius: 4px;
            font-family: var(--f-display); font-weight: 700; color: var(--cherry-deep);
            border: 1px solid var(--gold-leaf);
        }

        .card-details { padding: 25px; text-align: center; }

        .card-title {
            font-family: var(--f-display); font-size: 1.4rem; color: var(--walnut-ink);
            margin-bottom: 10px;
        }

        .card-preview {
            font-style: italic; color: #666; margin-bottom: 20px; font-size: 1.1rem; line-height: 1.5;
        }

        .btn-interact {
            width: 100%; padding: 16px; background: var(--walnut-ink);
            color: var(--gold-leaf); border: none; font-family: var(--f-display);
            text-transform: uppercase; letter-spacing: 2px; font-size: 0.8rem;
            cursor: pointer; transition: 0.2s; border-radius: 4px;
        }
        .btn-interact:active { background: var(--gold-leaf); color: #000; }


        /* ==========================================================================
           7. SPECIAL: THE BEATRIX POTTER DIVIDER
           ========================================================================== */
        .story-breaker {
            margin: 40px -20px; /* Bleed to edge */
            height: 300px;
            background-image: url('packaging-watercolor-woodland-art.jpg'); /* Supabase Logic handled below */
            background-attachment: fixed; /* Parallax effect */
            background-size: cover; background-position: center;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .story-breaker::after {
            content: ''; position: absolute; inset:0; background: rgba(253, 251, 247, 0.7);
        }
        
        .story-text-box {
            position: relative; z-index: 2; padding: 30px;
            background: white; border: 1px solid var(--gold-leaf);
            max-width: 80%; text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }


        /* ==========================================================================
           8. THE GRAND ARCHIVE (Detail Modal)
           ========================================================================== */
        .modal-screen {
            position: fixed; inset: 0; z-index: 6000;
            background: rgba(31, 26, 24, 0.7); backdrop-filter: blur(5px);
            display: none; opacity: 0; transition: 0.4s;
        }
        .modal-screen.active { display: block; opacity: 1; }

        .archive-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 92vh;
            background: #FDFBF7; /* Cream paper */
            border-radius: 20px 20px 0 0;
            transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            transform: translateY(100%); z-index: 6100;
            display: flex; flex-direction: column;
            overflow: hidden;
        }
        .archive-sheet.active { transform: translateY(0); }

        .sheet-header { height: 60px; display: flex; align-items: center; justify-content: flex-end; padding: 0 20px; border-bottom: 1px solid #eee; background: white;}
        
        .close-circle {
            width: 35px; height: 35px; border: 1px solid #ccc; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        }

        .sheet-scroll { flex: 1; overflow-y: auto; padding: 0 0 100px 0; }

        .hero-img-detail { height: 300px; width: 100%; object-fit: cover; }

        /* The Visual Module */
        .module-block {
            padding: 30px 25px;
        }

        .spec-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
            margin: 25px 0; border-top: 1px solid var(--gold-antique); border-bottom: 1px solid var(--gold-antique);
            padding: 15px 0;
        }
        .spec-item { text-align: center; border-right: 1px solid #ddd; }
        .spec-item:last-child { border: none; }
        .spec-label { font-family: var(--f-display); font-size: 0.6rem; color: #999; text-transform: uppercase; letter-spacing: 1px; }
        .spec-val { font-family: var(--f-body); font-size: 1.1rem; font-weight: bold; color: var(--cherry-deep); }

        /* Vintage Paper Effect for Notes */
        .notes-paper {
            background: #fff; padding: 25px; border: 1px solid #eee;
            margin-top: 30px; box-shadow: 3px 3px 0px rgba(0,0,0,0.05);
            position: relative;
        }
        .notes-paper::before { content: "From The Chef"; position: absolute; top: -10px; left: 20px; background: var(--cherry-deep); color: white; font-family: var(--f-display); font-size: 0.7rem; padding: 2px 10px; }

        /* Interaction Visuals */
        .interaction-img {
            border-radius: 8px; margin: 20px 0; border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); transform: rotate(-1deg);
        }

        /* Floating Add Button */
        .add-action-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 20px; background: rgba(255,255,255,0.9);
            border-top: 1px solid rgba(0,0,0,0.1);
        }
        .btn-add {
            width: 100%; padding: 18px; border-radius: 4px;
            background: var(--cherry-deep); color: white; border: none;
            font-family: var(--f-display); font-size: 1rem; letter-spacing: 2px;
            text-transform: uppercase; cursor: pointer;
            box-shadow: 0 5px 20px rgba(114, 17, 33, 0.3);
        }


        /* ==========================================================================
           9. THE SERVICES CONCIERGE FORM
           ========================================================================== */
        .form-card {
            background: white; padding: 30px 20px; border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.05); margin-top: -30px; position: relative; z-index: 5;
        }
        
        .form-row { margin-bottom: 20px; }
        .lbl { display: block; font-family: var(--f-display); font-size: 0.8rem; color: #888; margin-bottom: 8px; letter-spacing: 1px;}
        .inp {
            width: 100%; padding: 15px; font-family: var(--f-body); font-size: 1.1rem;
            border: 1px solid #ddd; background: #fafafa; transition: 0.3s; border-radius: 4px;
        }
        .inp:focus { outline: none; border-color: var(--cherry-deep); background: white; }
        
        textarea.inp { resize: vertical; min-height: 100px; }


        /* ==========================================================================
           10. THE TRUNK (Cart & Checkout)
           ========================================================================== */
        .drawer {
            position: fixed; top: 0; right: 0; width: 100%; height: 100%;
            background: var(--cream-paper); z-index: 7000;
            transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1);
            display: flex; flex-direction: column;
        }
        .drawer.open { transform: translateX(0); }

        .drawer-header {
            padding: 20px; display: flex; align-items: center; background: white; border-bottom: 1px solid #eee;
        }
        .drawer-title { flex: 1; text-align: center; font-family: var(--f-display); font-size: 1.2rem; }

        .drawer-content { flex: 1; padding: 25px; overflow-y: auto; }

        .cart-item-row {
            display: flex; justify-content: space-between; border-bottom: 1px dashed #ccc; padding-bottom: 15px; margin-bottom: 15px;
        }
        .rmv-btn { color: var(--cherry-deep); font-size: 0.8rem; text-decoration: underline; margin-top: 5px; display: block; }

        .drawer-footer {
            padding: 30px 25px 50px 25px; background: white; border-top: 1px solid #eee;
        }

        /* Location Dropdown Style */
        select.inp {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 10px auto;
        }

        /* ==========================================================================
           11. FOOTER (Added as requested)
           ========================================================================== */
        .site-footer {
            background: #1a1a1a; color: #888; padding: 50px 20px;
            text-align: center; font-size: 0.9rem;
        }
        .footer-logo { font-family: var(--f-script); color: var(--gold-leaf); font-size: 2.5rem; }
        .footer-links { margin: 20px 0; display: flex; justify-content: center; gap: 20px; font-family: var(--f-display); font-size: 0.7rem; }
        .legal { margin-top: 30px; font-size: 0.7rem; border-top: 1px solid #333; padding-top: 20px; }

    </style>
</head>
<body>

    <!-- ========================
         THE PRELOADER (Mobile AutoPlay Hack)
         ======================== -->
    <div id="estate-gate" onclick="enterManor()">
        <img src="pomelli-vintage-logo-script.jpg" class="gate-logo" alt="P">
        <button class="enter-btn">ENTER THE ESTATE</button>
    </div>


    <!-- ========================
         FIXED HEADER
         ======================== -->
    <header class="manor-nav">
        <!-- Logo aligned properly -->
        <div class="logo-wrap">
            <img src="pomelli-vintage-logo-script.jpg" class="nav-logo" alt="Pomelli">
        </div>
        <!-- Cart Trigger -->
        <div class="nav-action cart-wrapper" onclick="toggleCart()">
            <i class="fa-solid fa-suitcase"></i>
            <div class="cart-badge" id="cart-count">0</div>
        </div>
    </header>


    <!-- ========================
         HERO SECTION (Video)
         ======================== -->
    <div class="cinema-frame">
        <video id="bg-video" class="cinema-video" muted loop playsinline webkit-playsinline preload="auto">
            <!-- Ensure this file path is correct in your folder or Supabase -->
            <source src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/asembeling%20carrot%20cake%20video.mp4" type="video/mp4">
        </video>
        <div class="cinema-overlay">
            <span class="cinema-script">High Society</span>
            <h1 class="cinema-title">Winter Provisioning</h1>
        </div>
    </div>


    <!-- ========================
         TABS NAVIGATION
         ======================== -->
    <div class="tab-scroller">
        <div class="tab-track">
            <button class="tab-btn active" onclick="switchSection('cakes', this)">Grand Gâteaux</button>
            <button class="tab-btn" onclick="switchSection('buns', this)">Morning Goods</button>
            <button class="tab-btn" onclick="switchSection('concierge', this)">Butler Service</button>
        </div>
    </div>


    <!-- ========================
         SECTION 1: CAKES
         ======================== -->
    <section id="cakes" class="section-view active">
        <!-- CARD 1 -->
        <div class="estate-card">
            <div class="card-img-frame">
                <span class="price-badge">1250 EGP</span>
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/sovereign-carrot-cake-whole.jpg" class="card-img" loading="lazy">
            </div>
            <div class="card-details">
                <h2 class="card-title">The Sovereign Gâteau</h2>
                <p class="card-preview">A recipe guarded within family archives. Dense carrot sponge, oven-candied pecans, and pools of brown butter.</p>
                <button class="btn-interact" onclick="showCarrotDetails()">View Archive Entry</button>
            </div>
        </div>

        <!-- CARD 2 -->
        <div class="estate-card">
            <div class="card-img-frame">
                <span class="price-badge">140 EGP</span>
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/carrot-cake-slice-art-deco-plate.jpg" class="card-img" loading="lazy">
            </div>
            <div class="card-details">
                <h2 class="card-title">The Salon Slice</h2>
                <p class="card-preview">Gold-plated individual service. A single portion for the afternoon tea or private study.</p>
                <button class="btn-interact" onclick="addToCart('Salon Slice', 140)">Acquire Single Serving</button>
            </div>
        </div>
    </section>


    <!-- ========================
         SECTION 2: MORNING GOODS (BUNS)
         ======================== -->
    <section id="buns" class="section-view">
        <div class="estate-card">
            <div class="card-img-frame">
                <span class="price-badge">850 EGP</span>
                <!-- Fallback to external placeholder if local file missing -->
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/Flow%20Dec%2031%202025.jpeg" class="card-img" loading="lazy">
            </div>
            <div class="card-details">
                <h2 class="card-title">Sticky Pecan Buns</h2>
                <p class="card-preview">The ultimate holiday provision. 12 brioche spirals bathing in salted brown butter pecan caramel.</p>
                <button class="btn-interact" onclick="showBunDetails()">View The Romance</button>
            </div>
        </div>

        <!-- BEATRIX POTTER BREAK -->
        <div class="story-breaker">
            <div class="story-text-box">
                <h3 style="font-family: var(--f-display);">The Folklore</h3>
                <p style="font-style: italic; color: #555;">Arriving in Beatrix Potter boxes.</p>
            </div>
        </div>
    </section>


    <!-- ========================
         SECTION 3: CONCIERGE
         ======================== -->
    <section id="concierge" class="section-view">
        <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/butler-service-caramel-drip.jpg" style="border-radius: 12px; margin-bottom: 20px;">
        
        <div class="form-card">
            <h2 style="font-family: var(--f-display); text-align: center; margin-bottom: 20px;">Commission The Butler</h2>
            
            <div class="form-row">
                <label class="lbl">Client Title & Name</label>
                <input type="text" class="inp" id="req-name" placeholder="e.g. Lady Sarah...">
            </div>
            <div class="form-row">
                <label class="lbl">Estate District</label>
                <select class="inp" id="req-zone">
                    <option>Zamalek</option>
                    <option>Garden City</option>
                    <option>Maadi</option>
                    <option>New Cairo</option>
                    <option>Sheikh Zayed</option>
                </select>
            </div>
            <div class="form-row">
                <label class="lbl">Specific Desires</label>
                <textarea class="inp" id="req-details" placeholder="Service a la Russe setup, custom tiered cake..."></textarea>
            </div>
            
            <button class="btn-interact" onclick="sendServiceInquiry()">Dispatch Inquiry</button>
        </div>
    </section>


    <!-- ========================
         FOOTER
         ======================== -->
    <footer class="site-footer">
        <div class="footer-logo">Pomelli</div>
        <p>Private Estate Provisions • Cairo</p>
        <div class="footer-links">
            <span>INSTAGRAM</span>
            <span>CONTACT</span>
            <span>PRESS</span>
        </div>
        <div class="legal">
            &copy; 1922-2025 POMELLI ARCHIVES.<br>
            All packaging is plastic-free and heirloom quality.
        </div>
    </footer>


    <!-- =======================================================
         ARCHIVE SHEET (The Detailed Modals)
         *Dynamic Content Injected Here*
    ======================================================= -->
    <div class="modal-screen" id="modal-bg" onclick="closeSheet()"></div>
    
    <div class="archive-sheet" id="detail-sheet">
        <div class="sheet-header">
            <div class="close-circle" onclick="closeSheet()"><i class="fa-solid fa-xmark"></i></div>
        </div>
        
        <div class="sheet-scroll" id="sheet-inject">
            <!-- JS INJECTS CONTENT HERE -->
        </div>
        
        <!-- Add Button Logic Handled in JS injection or sticky -->
        <div class="add-action-bar">
            <button class="btn-add" id="sticky-add-btn" onclick="">Add to Trunk</button>
        </div>
    </div>


    <!-- ========================
         CART SLIDE-OUT
         ======================== -->
    <div class="drawer" id="cart-drawer">
        <div class="drawer-header">
            <div class="nav-action" onclick="toggleCart()"><i class="fa-solid fa-arrow-left"></i></div>
            <div class="drawer-title">Your Trunk</div>
        </div>
        
        <div class="drawer-content" id="cart-items-area">
            <p style="text-align: center; color: #999; margin-top: 50px;">The trunk is empty, sir.</p>
        </div>

        <div class="drawer-footer">
            <div class="form-row">
                <label class="lbl">Delivery Name</label>
                <input type="text" id="order-name" class="inp">
            </div>
            <div class="form-row">
                <label class="lbl">Cairo District</label>
                <select class="inp" id="order-zone">
                    <option value="Zamalek">Zamalek</option>
                    <option value="Maadi">Maadi</option>
                    <option value="New Cairo">New Cairo</option>
                    <option value="Sheikh Zayed">Sheikh Zayed</option>
                    <option value="Heliopolis">Heliopolis</option>
                    <option value="Dokki">Dokki</option>
                </select>
            </div>
            <div class="form-row">
                <label class="lbl">Building/Street</label>
                <input type="text" id="order-addr" class="inp">
            </div>
            
            <button class="btn-add" onclick="checkoutWhatsapp()">Request via WhatsApp</button>
        </div>
    </div>


    <!-- ==========================================================================
       THE BRAIN (JAVASCRIPT)
       *Contains specific recipes text, cart logic, mobile video handlers*
    ========================================================================== -->
    <script>
        
        /* 1. ENTER THE ESTATE (Mobile Video Fix) */
        function enterManor() {
            const gate = document.getElementById('estate-gate');
            const vid = document.getElementById('bg-video');
            
            gate.classList.add('open');
            
            // Interaction forces video play
            vid.muted = true; // Browser policy
            vid.play().then(() => {
                // Video started
            }).catch(e => {
                console.log("Autoplay prevents: ", e);
            });
        }

        /* 2. TAB SWITCHING */
        function switchSection(id, btn) {
            // Hide all
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            // Show Target
            document.getElementById(id).classList.add('active');
            if(btn) btn.classList.add('active');
            
            window.scrollTo({top: window.innerHeight * 0.6, behavior: 'smooth'});
        }

        /* 3. CART SYSTEM */
        let cart = [];

        function addToCart(name, price) {
            cart.push({name, price});
            updateBadge();
            closeSheet();
            // Subtle Haptic Feedback visual
            document.querySelector('.cart-wrapper').style.transform = 'scale(1.2)';
            setTimeout(()=> document.querySelector('.cart-wrapper').style.transform = 'scale(1)', 200);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateBadge();
            renderCart();
        }

        function updateBadge() {
            const b = document.getElementById('cart-count');
            b.innerText = cart.length;
            if(cart.length > 0) b.classList.add('active');
            else b.classList.remove('active');
        }

        function toggleCart() {
            const d = document.getElementById('cart-drawer');
            if(d.classList.contains('open')) {
                d.classList.remove('open');
            } else {
                renderCart();
                d.classList.add('open');
            }
        }

        function renderCart() {
            const area = document.getElementById('cart-items-area');
            if(cart.length === 0) {
                area.innerHTML = '<p style="text-align: center; color: #999; margin-top: 50px;">The trunk is empty, sir.</p>';
                return;
            }
            
            let html = '';
            let total = 0;
            cart.forEach((item, idx) => {
                total += item.price;
                html += `
                <div class="cart-item-row">
                    <div>
                        <div style="font-family: var(--f-display);">${item.name}</div>
                        <div class="rmv-btn" onclick="removeFromCart(${idx})">Remove</div>
                    </div>
                    <div style="font-weight:bold;">${item.price} EGP</div>
                </div>`;
            });
            html += `<div style="text-align:right; font-size:1.2rem; font-family:var(--f-display); margin-top:20px;">Total: ${total} EGP</div>`;
            area.innerHTML = html;
        }

        /* 4. DETAIL SHEETS (With Poetic Text) */
        
        function openSheet(content, addFnName, addFnPrice) {
            document.getElementById('sheet-inject').innerHTML = content;
            
            // Set Button Action
            const btn = document.getElementById('sticky-add-btn');
            btn.innerHTML = `Add to Trunk (${addFnPrice} EGP)`;
            btn.onclick = function() { addToCart(addFnName, addFnPrice); };

            document.getElementById('modal-bg').classList.add('active');
            document.getElementById('detail-sheet').classList.add('active');
        }

        function closeSheet() {
            document.getElementById('modal-bg').classList.remove('active');
            document.getElementById('detail-sheet').classList.remove('active');
        }

        /* --- THE CONTENT MODULES --- */
        
        function showCarrotDetails() {
            const content = `
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/sovereign-carrot-cake-whole.jpg" class="hero-img-detail">
                <div class="module-block">
                    <h2 style="font-family:var(--f-display); font-size:2rem; line-height:1; margin-bottom:10px;">The Sovereign Gâteau</h2>
                    <p style="font-size:1.1rem; color:#666;">Grand Rectangular Tier</p>
                    
                    <div class="spec-grid">
                        <div class="spec-item"><div class="spec-label">Yield</div><div class="spec-val">16</div></div>
                        <div class="spec-item"><div class="spec-label">Time</div><div class="spec-val">2 Days</div></div>
                        <div class="spec-item"><div class="spec-label">Texture</div><div class="spec-val">Dense</div></div>
                    </div>

                    <div style="line-height:1.8; color:#444;">
                        Inspired by the recipes of old southern estates. Features layers of moist carrot cake with pineapple and toasted coconut, separating tiers of brown-butter cream cheese. The hidden luxury? A layer of oven-candied pecans buried inside.
                    </div>

                    <img src="watercolored carrot cake.jpg" class="interaction-img" alt="Illustration">

                    <div class="notes-paper">
                        <p style="margin-bottom:10px;"><strong>The Structure:</strong> Built in a grand A4-rectangular pan. Rustically iced.</p>
                        <p><strong>The Butterscotch:</strong> We utilize leftover yolks to create a rich salted sauce that is drizzled between layers.</p>
                    </div>
                </div>
            `;
            openSheet(content, "Sovereign Gâteau", 1250);
        }

        function showBunDetails() {
            // Note: The specific wording requested
            const content = `
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/Flow%20Dec%2031%202025.jpeg" class="hero-img-detail">
                <div class="module-block">
                    <h2 style="font-family:var(--f-display); font-size:2rem; line-height:1; margin-bottom:10px;">Sticky Pecan Buns</h2>
                    <p style="font-size:1.1rem; color:#666;">Morning Tray of 12</p>
                    
                    <div class="spec-grid">
                        <div class="spec-item"><div class="spec-label">Rolls</div><div class="spec-val">12</div></div>
                        <div class="spec-item"><div class="spec-label">Prep</div><div class="spec-val">3 Hrs</div></div>
                        <div class="spec-item"><div class="spec-label">Heat</div><div class="spec-val">Warm</div></div>
                    </div>

                    <!-- GLOVE GUY PHOTO -->
                    <img src="sticky_glove.jpg" class="interaction-img" alt="Pulling Apart">

                    <div style="line-height:1.8; color:#444;">
                        "You can’t have a bad day when it starts with caramel pecan sticky buns."<br><br>
                        These soft, buttery cinnamon rolls are finished with an ooey-gooey caramel pecan praline topping. The dough is stretched until it is pillowy soft, rolled tightly with brown sugar, and then baked <em>on top of</em> a bed of boiling caramel.
                    </div>

                    <div class="notes-paper">
                        <p style="margin-bottom:10px;"><strong>Technique:</strong> We invert the pan immediately after baking, allowing the caramel to coat the brioche before it sets into a glass-like shell.</p>
                        <p><strong>Flavor:</strong> Salted Brown Butter & Cinnamon.</p>
                    </div>
                </div>
            `;
            openSheet(content, "Sticky Buns", 850);
        }

        /* 5. WHATSAPP GATEWAYS (The "Persona" Logic) */

        function checkoutWhatsapp() {
            if(cart.length === 0) return alert("The trunk is empty, Sir.");
            
            const name = document.getElementById('order-name').value;
            const zone = document.getElementById('order-zone').value;
            const addr = document.getElementById('order-addr').value;

            if(!name || !addr) return alert("Kindly provide delivery details.");

            let itemString = "";
            let total = 0;
            cart.forEach(i => {
                itemString += `- ${i.name} (${i.price} EGP)%0a`;
                total += i.price;
            });

            // "Butler Persona" Message
            const msg = `*GOOD EVENING, BUTLER.*%0aI wish to secure the following provisions:%0a%0a${itemString}%0a*TOTAL: ${total} EGP*%0a%0aKindly dispatch to my residence:%0aName: ${name}%0aDistrict: ${zone}%0aAddress: ${addr}`;
            
            window.open(`https://wa.me/201024274466?text=${msg}`);
        }

        function sendServiceInquiry() {
            const name = document.getElementById('req-name').value;
            const zone = document.getElementById('req-zone').value;
            const req = document.getElementById('req-details').value;

            if(!name || !req) return alert("Incomplete Request");

            const msg = `*COMMISSION REQUEST*%0a%0aMy name is ${name} residing in ${zone}.%0aI inquire about the following service:%0a${req}`;
            window.open(`https://wa.me/201024274466?text=${msg}`);
        }

    </script>
</body>
</html>
