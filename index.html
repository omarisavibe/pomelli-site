<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pomelli | The Estate App</title>
    <meta name="theme-color" content="#F9F8F4">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- HIGH END FONTS & ICONS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600&family=Monsieur+La+Doulaise&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

    <style>
        /* ==========================================================================
           1. LUXURY MOBILE FOUNDATION
           ========================================================================== */
        :root {
            --brand-cherry: #721121;
            --brand-cherry-dark: #4a0b15;
            --brand-cream: #F9F8F4;
            --brand-paper: #F0EEE6;
            --brand-walnut: #221a19;
            --brand-gold: #cfaa6e;
            --brand-gold-dim: #bba27e;
            --font-display: 'Cinzel', serif;
            --font-body: 'Cormorant Garamond', serif;
            --font-script: 'Monsieur La Doulaise', cursive;
            
            --shadow-soft: 0 10px 40px rgba(0,0,0,0.08);
            --shadow-hard: 0 5px 15px rgba(0,0,0,0.15);
            --curve: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--brand-cream);
            color: var(--brand-walnut);
            font-family: var(--font-body);
            overflow-x: hidden;
            font-size: 17px;
            padding-bottom: 120px; /* Space for Floating Nav/Footer */
        }

        img { width: 100%; display: block; object-fit: cover; }
        
        /* Typography Utility Classes */
        .text-display { font-family: var(--font-display); text-transform: uppercase; letter-spacing: 0.05em; }
        .text-script { font-family: var(--font-script); color: var(--brand-gold-dim); font-size: 2.5rem; line-height: 0.6; }
        .text-body { line-height: 1.6; color: #555; }
        .text-accent { color: var(--brand-cherry); font-weight: bold; }

        /* Animation Keyframes */
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        @keyframes slideUp { from {transform: translateY(30px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

        /* ==========================================================================
           2. NAVIGATION & HEADER
           ========================================================================== */
        .app-header {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(249, 248, 244, 0.96);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(0,0,0,0.04);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }
        
        /* The Logo (Scaled Properly) */
        .logo-container { height: 32px; width: auto; overflow: hidden; display: flex; align-items: center; }
        .nav-logo { height: 100%; width: auto; mix-blend-mode: multiply; transform: scale(1.1); }

        .header-actions { display: flex; align-items: center; gap: 20px; }
        
        .cart-icon-wrapper { position: relative; color: var(--brand-walnut); font-size: 1.2rem; cursor: pointer; }
        .cart-dot {
            position: absolute; top: -5px; right: -8px;
            width: 16px; height: 16px; background: var(--brand-cherry);
            border: 2px solid var(--brand-cream); border-radius: 50%;
            display: none; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .cart-dot.active { display: block; transform: scale(1); }

        /* ==========================================================================
           3. HERO VIDEO
           ========================================================================== */
        .hero-section {
            position: relative; width: 100%; height: 50vh;
            border-radius: 0 0 var(--curve) var(--curve);
            overflow: hidden; box-shadow: var(--shadow-soft);
            background: #111;
        }
        .hero-video { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.7); }
        .hero-text {
            position: absolute; bottom: 30px; left: 25px;
            color: white; z-index: 2; text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .hero-text h1 { font-size: 2rem; margin-top: 10px; line-height: 1.1; }

        /* ==========================================================================
           4. STICKY TABS (NAVIGATION)
           ========================================================================== */
        .tab-scroller {
            position: sticky; top: 60px; z-index: 900;
            background: var(--brand-cream);
            padding: 15px 20px;
            display: flex; gap: 12px;
            overflow-x: auto;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            /* Hide scrollbar */
            scrollbar-width: none; -ms-overflow-style: none;
        }
        .tab-scroller::-webkit-scrollbar { display: none; }

        .tab-chip {
            padding: 8px 18px; border-radius: 40px;
            border: 1px solid #E5E0D6;
            background: transparent; color: #777;
            font-family: var(--font-display); font-size: 0.8rem; letter-spacing: 0.5px;
            white-space: nowrap; flex-shrink: 0;
            cursor: pointer; transition: 0.3s ease;
        }
        .tab-chip.active {
            background: var(--brand-walnut);
            border-color: var(--brand-walnut);
            color: var(--brand-gold);
            box-shadow: 0 4px 10px rgba(44, 33, 28, 0.2);
        }

        /* ==========================================================================
           5. CONTENT GRIDS
           ========================================================================== */
        .content-feed { padding: 25px 15px; min-height: 60vh; }
        
        .section-view { display: none; animation: slideUp 0.6s ease; }
        .section-view.active { display: block; }

        .product-card {
            background: white; border-radius: 18px;
            overflow: hidden; margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
            position: relative; transition: transform 0.3s;
        }
        .product-card:active { transform: scale(0.98); }

        .card-img { height: 320px; width: 100%; }
        
        .price-badge {
            position: absolute; top: 15px; right: 15px;
            background: rgba(255,255,255,0.9);
            padding: 8px 14px; border-radius: 12px;
            font-family: var(--font-display); font-weight: 600;
            color: var(--brand-cherry);
            backdrop-filter: blur(5px);
        }

        .card-meta { padding: 25px; }
        .card-meta h3 { font-family: var(--font-display); font-size: 1.4rem; color: var(--brand-walnut); }
        .card-meta p { font-size: 0.95rem; color: #666; margin: 8px 0 20px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;}
        
        .btn-view {
            width: 100%; padding: 16px;
            background: transparent;
            border: 1px solid #ddd;
            border-radius: 12px;
            color: var(--brand-walnut);
            font-family: var(--font-display);
            text-transform: uppercase;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Story Visual Break */
        .story-insert {
            background: #E8ECE6;
            margin: 40px 10px; padding: 40px 20px;
            border-radius: var(--curve);
            text-align: center; border: 4px double white;
            background-image: url('https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/packaging-watercolor-woodland-art.jpg');
            background-size: cover;
            box-shadow: var(--shadow-soft);
        }
        .story-badge { background:white; display:inline-block; padding: 8px 20px; border-radius:30px; font-family:var(--font-display); font-size:0.8rem; margin-bottom:15px; }

        /* ==========================================================================
           6. FULL SCREEN DETAIL SHEETS (THE DEPTH)
           ========================================================================== */
        .sheet-backdrop {
            position: fixed; inset: 0; background: rgba(34, 26, 25, 0.4); z-index: 2000;
            opacity: 0; pointer-events: none; transition: opacity 0.4s;
            backdrop-filter: blur(4px);
        }
        .sheet-backdrop.active { opacity: 1; pointer-events: auto; }

        .detail-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 92vh;
            background: white; z-index: 2100;
            border-radius: 30px 30px 0 0;
            transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            overflow-y: auto; padding-bottom: 140px; /* Footer space */
            box-shadow: 0 -10px 50px rgba(0,0,0,0.2);
        }
        .detail-sheet.active { transform: translateY(0); }

        .sheet-close-fab {
            position: fixed; top: 30px; right: 25px;
            width: 44px; height: 44px; background: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); z-index: 2200;
            cursor: pointer; font-size: 1.2rem;
            transform: scale(0); transition: 0.3s 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .detail-sheet.active ~ .sheet-close-fab { transform: scale(1); }

        /* Header Image inside Sheet */
        .sheet-hero-img {
            width: 100%; height: 380px; object-fit: cover;
            border-bottom: 4px solid var(--brand-cream);
        }

        .sheet-content { padding: 40px 25px; }

        /* METRIC GRID (Prep Time, Yield, Etc.) */
        .metric-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            margin: 30px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding: 20px 0;
        }
        .metric-box { text-align: center; }
        .m-val { display: block; font-family: var(--font-display); font-weight: 700; font-size: 1.1rem; color: var(--brand-walnut); }
        .m-lbl { display: block; font-size: 0.75rem; text-transform: uppercase; color: #999; margin-top: 5px; letter-spacing: 1px; }

        /* RICH TEXT ARCHIVE */
        .recipe-archive {
            background: #FDFCF9; border: 1px solid #EEE;
            border-radius: 12px; padding: 25px; margin-top: 30px;
        }
        .archive-header {
            font-family: var(--font-display); font-size: 1.1rem; color: var(--brand-gold); margin-bottom: 20px;
            border-bottom: 2px solid #EEE; padding-bottom: 10px;
        }
        
        .ingredients-list { list-style: none; margin-bottom: 30px; }
        .ingredients-list li {
            padding: 8px 0; border-bottom: 1px dashed #eee;
            font-size: 0.95rem; display: flex; justify-content: space-between;
        }
        .ingredients-list li b { color: var(--brand-walnut); font-weight: 600; }
        
        /* Floating CTA Footer */
        .float-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; border-top: 1px solid #eee;
            padding: 20px 25px; z-index: 2300;
            display: none;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }
        .float-footer.visible { display: block; animation: slideUp 0.3s; }
        
        .btn-action {
            width: 100%; border: none; padding: 18px; border-radius: 50px;
            background: var(--brand-cherry); color: white;
            font-family: var(--font-display); font-size: 1rem;
            text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(114, 17, 33, 0.4);
            transition: transform 0.2s;
        }
        .btn-action:active { transform: scale(0.95); }

        /* Service Form Inputs */
        .inquiry-group { margin-bottom: 20px; }
        .inquiry-label { display: block; font-family: var(--font-display); font-size: 0.8rem; color: #888; margin-bottom: 8px; }
        .inquiry-input { 
            width: 100%; padding: 15px; border: 1px solid #ddd; background: #fff;
            border-radius: 10px; font-family: var(--font-body); font-size: 1.1rem;
        }
        
        /* ==========================================================================
           7. CART / CHECKOUT
           ========================================================================== */
        .checkout-sheet {
            background: #F8F6F1;
        }
        .cart-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .cart-item-card {
            background: white; border-radius: 12px; padding: 15px;
            display: flex; gap: 15px; align-items: center; margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .cart-thumb { width: 60px; height: 60px; border-radius: 8px; background: #ddd; object-fit: cover; }
        
        /* Specific image classes for insertion */
        .embedded-watercolor {
            border-radius: 8px; box-shadow: var(--shadow-soft); margin: 30px 0; border: 4px solid white;
        }
        .embedded-glove {
            border-radius: 8px; box-shadow: var(--shadow-soft); margin: 20px 0; 
            filter: contrast(1.1); 
        }

    </style>
</head>
<body>

    <!-- 1. HEADER -->
    <header class="app-header">
        <div class="logo-container">
            <!-- Ensure pomelli-vintage-logo-script.jpg is in folder -->
            <img src="pomelli-vintage-logo-script.jpg" class="nav-logo" alt="Pomelli">
        </div>
        <div class="header-actions">
            <div class="cart-icon-wrapper" onclick="openCheckout()">
                <i class="fa-solid fa-basket-shopping"></i>
                <div class="cart-dot" id="cart-badge"></div>
            </div>
        </div>
    </header>

    <!-- 2. HERO -->
    <div class="hero-section">
        <video class="hero-video" autoplay muted loop playsinline>
            <source src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/asembeling%20carrot%20cake%20video.mp4" type="video/mp4">
        </video>
        <div class="hero-text">
            <span class="text-script">Winter Archives</span>
            <h1 class="text-display">The Estate<br>Collection</h1>
        </div>
    </div>

    <!-- 3. TABS -->
    <nav class="tab-scroller">
        <button class="tab-chip active" onclick="switchTab('cakes', this)">Grand Gâteaux</button>
        <button class="tab-chip" onclick="switchTab('morning', this)">Morning Goods</button>
        <button class="tab-chip" onclick="switchTab('services', this)">Estate Services</button>
        <button class="tab-chip" onclick="switchTab('story', this)">Folklore</button>
    </nav>

    <!-- 4. MAIN CONTENT FEED -->
    <main class="content-feed">
        
        <!-- === TAB: CAKES === -->
        <section id="cakes" class="section-view active">
            <!-- SOVEREIGN GATEAU -->
            <div class="product-card">
                <div class="price-badge">1,250 EGP</div>
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/sovereign-carrot-cake-whole.jpg" class="card-img" alt="Whole Cake">
                <div class="card-meta">
                    <h3 class="text-display">The Sovereign Gâteau</h3>
                    <p class="text-body">A breathless tower featuring layers of moist carrot sponge with pineapple, coconut, and brown-butter butterscotch.</p>
                    <button class="btn-view" onclick="openProduct('cake')">View The Archives</button>
                </div>
            </div>

            <!-- SLICE -->
            <div class="product-card">
                <div class="price-badge">140 EGP</div>
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/carrot-cake-slice-art-deco-plate.jpg" class="card-img" alt="Slice">
                <div class="card-meta">
                    <h3 class="text-display">The Salon Slice</h3>
                    <p class="text-body">A generous individual serving. Plated for solitary luxury or afternoon tea.</p>
                    <button class="btn-view" onclick="openProduct('slice')">View Details</button>
                </div>
            </div>
        </section>

        <!-- === TAB: MORNING GOODS === -->
        <section id="morning" class="section-view">
            <!-- STICKY BUNS -->
            <div class="product-card">
                <div class="price-badge">850 EGP</div>
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/Flow%20Dec%2031%202025.jpeg" class="card-img" alt="Sticky Buns">
                <div class="card-meta">
                    <h3 class="text-display">Sticky Pecan Buns</h3>
                    <p class="text-body">Soft, buttery cinnamon rolls finished with an ooey-gooey caramel pecan praline topping.</p>
                    <button class="btn-view" onclick="openProduct('buns')">View The Notes</button>
                </div>
            </div>

             <!-- Visual Break -->
             <div class="story-insert">
                <span class="story-badge">Packaging Folklore</span>
                <p>Plastic-free. Wrapped in watercolor art.</p>
            </div>
        </section>

        <!-- === TAB: SERVICE === -->
        <section id="services" class="section-view">
            <!-- BUTLER SERVICE -->
            <div class="product-card">
                <div class="price-badge" style="background:var(--brand-walnut); color:white;">INQUIRE</div>
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/butler-service-caramel-drip.jpg" class="card-img">
                <div class="card-meta">
                    <h3 class="text-display">Service à la Russe</h3>
                    <p class="text-body">A butler arrives at your estate to plate the dessert tableside. Warm sauce, cold cream, white gloves.</p>
                    <!-- BUTTON OPENS SPECIFIC SERVICE FORM -->
                    <button class="btn-view" onclick="openServiceInquiry()">Configure Service</button>
                </div>
            </div>
            
            <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/carrot-cake-manor-interior.jpg" style="border-radius:18px; margin-top:20px;">
        </section>

        <!-- === TAB: FOLKLORE === -->
        <section id="story" class="section-view">
            <div style="text-align:center; padding: 40px 10px;">
                <span class="text-script" style="color:var(--brand-cherry);">Beatrix Potter</span>
                <h1 class="text-display" style="font-size:2rem; margin:10px 0 20px;">The Packaging</h1>
                <p class="text-body">Every order from Pomelli is an exchange of trust. We do not use industrial plastic. Your confections arrive in heavy card stock, printed with vintage watercolors of the woodland.</p>
                <img src="https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/vintage-storybook-illustration-wide.jpg" style="border:4px solid white; box-shadow:var(--shadow-soft); border-radius:10px; margin-top:30px;">
            </div>
        </section>

    </main>

    <!-- ==========================================================================
       MODALS & SHEETS
       ========================================================================== -->

    <!-- BACKGROUND DIMMER -->
    <div class="sheet-backdrop" id="backdrop" onclick="closeSheets()"></div>
    <div class="sheet-close-fab" id="fab" onclick="closeSheets()"><i class="fa-solid fa-times"></i></div>

    <!-- PRODUCT DETAIL SHEET -->
    <div class="detail-sheet" id="product-sheet">
        <img src="" id="ps-img" class="sheet-hero-img">
        <div class="sheet-content">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <h1 class="text-display" style="font-size:1.8rem; line-height:1.2; width:70%;" id="ps-title">Title</h1>
                <span class="text-accent" style="font-size:1.4rem;" id="ps-price">Price</span>
            </div>

            <!-- Dynamic Metrics Inject Here -->
            <div id="ps-metrics"></div>

            <p class="text-body" style="font-size:1.1rem; color:#333;" id="ps-desc">Desc</p>

            <!-- EXTRA IMAGES AREA -->
            <div id="ps-extra-visuals"></div>

            <!-- THE ARCHIVE (RECIPE DATA) -->
            <div class="recipe-archive">
                <div class="archive-header">From the Chef's Journal</div>
                <div id="ps-recipe-content"></div>
            </div>

        </div>
    </div>

    <!-- SERVICE INQUIRY SHEET (The Form) -->
    <div class="detail-sheet" id="service-sheet">
        <div style="background:var(--brand-walnut); color:white; padding:40px 25px 25px;">
            <span class="text-display" style="opacity:0.7;">The Concierge Desk</span>
            <h2 class="text-display" style="font-size:2rem; margin-top:5px;">Inquire for Service</h2>
        </div>
        <div class="sheet-content">
            <p class="text-body" style="margin-bottom:30px;">This does not add to your trunk. Instead, fill out the particulars below and we will construct a bespoke invoice via WhatsApp.</p>
            
            <div class="inquiry-group">
                <label class="inquiry-label">Preferred Date</label>
                <input type="date" class="inquiry-input" id="serv-date">
            </div>
            <div class="inquiry-group">
                <label class="inquiry-label">District (e.g. Zamalek)</label>
                <input type="text" class="inquiry-input" id="serv-loc" placeholder="Estate Location">
            </div>
             <div class="inquiry-group">
                <label class="inquiry-label">Host Name</label>
                <input type="text" class="inquiry-input" id="serv-name" placeholder="Your Name">
            </div>

            <button class="btn-action" style="background:var(--brand-walnut);" onclick="submitServiceInquiry()">Send to Butler</button>
            <p style="text-align:center; color:#999; font-size:0.8rem; margin-top:15px;">Connects to 01024274466</p>
        </div>
    </div>

    <!-- CHECKOUT SHEET -->
    <div class="detail-sheet checkout-sheet" id="checkout-sheet">
        <div class="sheet-content">
            <div class="cart-header-row">
                <h2 class="text-display">Your Trunk</h2>
                <span class="text-script" style="font-size:2rem; color:var(--brand-walnut);" id="checkout-total">0 EGP</span>
            </div>

            <div id="cart-list">
                <!-- Cart Items Go Here -->
                <p style="text-align:center; padding:40px; color:#aaa; font-style:italic;">Your trunk is empty.</p>
            </div>

            <div style="margin-top:40px; padding-top:20px; border-top:1px solid #ddd;">
                <h3 class="text-display" style="font-size:1rem; margin-bottom:20px; color:var(--brand-cherry);">Dispatch Details</h3>
                <div class="inquiry-group">
                    <input type="text" class="inquiry-input" id="cust-name" placeholder="Full Name">
                </div>
                <div class="inquiry-group">
                    <input type="text" class="inquiry-input" id="cust-addr" placeholder="Address">
                </div>
            </div>
        </div>
    </div>

    <!-- FLOATING FOOTER BUTTON -->
    <div class="float-footer" id="main-action-bar">
        <!-- Text changes based on context -->
        <button class="btn-action" id="main-btn" onclick="">Add to Trunk</button>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // === DATA: THE ARCHIVE ===
        const products = {
            cake: {
                title: "Sovereign Gâteau",
                price: 1250,
                img: "https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/sovereign-carrot-cake-whole.jpg",
                desc: "Features layers of moist carrot cake with pineapple and coconut, candied pecans, a rich butterscotch and tangy cream cheese frosting. Inspired by Truluck's.",
                // THE WATERCOLORED CARROT CAKE GOES HERE
                extraImg: `<img src="watercolored carrot cake.jpg" class="embedded-watercolor" alt="Watercolor Sketch">`,
                metrics: [
                    {val: "2 Hrs", lbl: "Prep"},
                    {val: "1.2 Hrs", lbl: "Bake"},
                    {val: "16", lbl: "Serves"}
                ],
                archive: `
                    <ul class="ingredients-list">
                        <li><b>Cake Base</b> <span>Grated Carrots, Pineapple, Coconut</span></li>
                        <li><b>The Crunch</b> <span>Oven-Candied Pecans</span></li>
                        <li><b>The Glue</b> <span>Brown Butter Cream Cheese</span></li>
                        <li><b>The Sauce</b> <span>Salted Butterscotch</span></li>
                    </ul>
                    <p class="text-body" style="font-size:0.9rem;">
                        <strong>Instructions Highlight:</strong> "Whisk together the egg yolk, cream and brown sugar in a small saucepan. Bring to a boil over medium-low heat... drizzle butterscotch between every layer."
                    </p>
                `
            },
            slice: {
                title: "The Salon Slice",
                price: 140,
                img: "https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/carrot-cake-slice-art-deco-plate.jpg",
                desc: "A single gold-standard portion of our Sovereign Gâteau. Served with an extra vial of butterscotch.",
                extraImg: ``,
                metrics: [
                    {val: "0 Min", lbl: "Prep"},
                    {val: "Instant", lbl: "Ready"},
                    {val: "1", lbl: "Serves"}
                ],
                archive: `<p class="text-body">The same architectural integrity of the whole gâteau, plated for individual enjoyment.</p>`
            },
            buns: {
                title: "Sticky Pecan Buns",
                price: 850,
                img: "https://rfwlaucrlfohxrrspxmx.supabase.co/storage/v1/object/public/pomelli-gallery/Flow%20Dec%2031%202025.jpeg",
                desc: "Soft and buttery cinnamon rolls finished off with an ooey-gooey caramel pecan praline topping. The gluten is developed until pillowy soft.",
                // THE STICKY GLOVE IMAGE GOES HERE
                extraImg: `<img src="sticky_glove.jpg" class="embedded-glove" alt="Sticky Texture">
                           <p class="text-body" style="font-style:italic; font-size:0.9rem; text-align:center;">The Pull-Apart Moment...</p>`,
                metrics: [
                    {val: "3 Hrs", lbl: "Total Time"},
                    {val: "12", lbl: "Rolls"},
                    {val: "Med", lbl: "Richness"}
                ],
                archive: `
                    <ul class="ingredients-list">
                        <li><b>The Dough</b> <span>Rapid Yeast, Milk, Butter</span></li>
                        <li><b>Filling</b> <span>Brown Sugar, Cinnamon (High Grade)</span></li>
                        <li><b>Topping</b> <span>Pecan Pralines, Corn Syrup, Butter</span></li>
                    </ul>
                    <p class="text-body" style="font-size:0.9rem; margin-top:10px;">
                        <strong>Method:</strong> "Turn the dough out... knead for 10 minutes until smooth. Bake at 350°F until golden, then flip onto serving board to reveal gooey caramel bottom."
                    </p>
                `
            }
        };

        let cart = [];

        // === NAVIGATION LOGIC ===
        function switchTab(id, el) {
            // UI Styling
            document.querySelectorAll('.tab-chip').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            
            // View Switching
            document.querySelectorAll('.section-view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // Scroll to top of content
            window.scrollTo({top: 400, behavior: 'smooth'}); 
        }

        // === PRODUCT SHEET LOGIC ===
        function openProduct(key) {
            const data = products[key];
            
            // Populate
            document.getElementById('ps-img').src = data.img;
            document.getElementById('ps-title').innerText = data.title;
            document.getElementById('ps-price').innerText = data.price + " EGP";
            document.getElementById('ps-desc').innerText = data.desc;
            document.getElementById('ps-extra-visuals').innerHTML = data.extraImg;
            document.getElementById('ps-recipe-content').innerHTML = data.archive;

            // Generate Metric Grid HTML
            let metricsHTML = `<div class="metric-grid">`;
            data.metrics.forEach(m => {
                metricsHTML += `<div class="metric-box"><span class="m-val">${m.val}</span><span class="m-lbl">${m.lbl}</span></div>`;
            });
            metricsHTML += `</div>`;
            document.getElementById('ps-metrics').innerHTML = metricsHTML;

            // Set Button Action
            const btn = document.getElementById('main-btn');
            btn.innerText = "Add To Trunk";
            btn.onclick = function() { addToCart(data); };
            
            // Animations
            openBackdrop();
            document.getElementById('product-sheet').classList.add('active');
            document.getElementById('main-action-bar').classList.add('visible');
        }

        // === SERVICE SHEET LOGIC (Inquiry only) ===
        function openServiceInquiry() {
            openBackdrop();
            document.getElementById('service-sheet').classList.add('active');
            // Hide the main checkout/add button, handled internally in sheet
            document.getElementById('main-action-bar').classList.remove('visible'); 
        }

        function submitServiceInquiry() {
            const date = document.getElementById('serv-date').value;
            const loc = document.getElementById('serv-loc').value;
            const name = document.getElementById('serv-name').value;
            
            if(!date || !name) return alert("Please fill details.");
            
            const msg = `*SERVICE INQUIRY - POMELLI*%0a%0aName: ${name}%0aRequest: Service a la Russe%0aDate: ${date}%0aLocation: ${loc}`;
            
            window.open(`https://wa.me/201024274466?text=${msg}`);
        }


        // === CHECKOUT / CART LOGIC ===
        function addToCart(product) {
            cart.push(product);
            
            // Feedback
            closeSheets();
            updateCartIcon();
        }

        function updateCartIcon() {
            document.getElementById('cart-badge').classList.add('active');
            // Brief visual animation on bag could go here
        }

        function openCheckout() {
            renderCartList();
            
            // Set footer button
            const btn = document.getElementById('main-btn');
            btn.innerText = "Confirm via WhatsApp";
            btn.onclick = processWhatsAppOrder;

            openBackdrop();
            document.getElementById('checkout-sheet').classList.add('active');
            document.getElementById('main-action-bar').classList.add('visible');
        }

        function renderCartList() {
            const container = document.getElementById('cart-list');
            let html = "";
            let total = 0;
            
            if(cart.length === 0) {
                 container.innerHTML = `<p style="text-align:center; padding:40px; color:#aaa; font-style:italic;">Your trunk is empty.</p>`;
                 document.getElementById('checkout-total').innerText = "0 EGP";
                 return;
            }

            cart.forEach(item => {
                total += item.price;
                html += `
                <div class="cart-item-card">
                    <img src="${item.img}" class="cart-thumb">
                    <div style="flex:1;">
                        <h4 style="font-family:var(--font-display);">${item.title}</h4>
                        <span style="color:var(--brand-cherry); font-weight:bold;">${item.price} EGP</span>
                    </div>
                </div>`;
            });
            
            container.innerHTML = html;
            document.getElementById('checkout-total').innerText = total + " EGP";
        }

        function processWhatsAppOrder() {
            if(cart.length === 0) return alert("Trunk is empty.");
            
            const name = document.getElementById('cust-name').value;
            const addr = document.getElementById('cust-addr').value;
            
            if(!name || !addr) return alert("Please provide Name & Address for delivery.");

            let msg = `*NEW ORDER - POMELLI APP*%0aName: ${name}%0aAddress: ${addr}%0a%0aITEMS:%0a`;
            let total = 0;
            cart.forEach(i => {
                msg += `- ${i.title} (${i.price})%0a`;
                total += i.price;
            });
            msg += `%0a*TOTAL: ${total} EGP*`;

            window.open(`https://wa.me/201024274466?text=${msg}`);
        }

        // === GLOBAL UTILS ===
        function openBackdrop() {
            document.getElementById('backdrop').classList.add('active');
            // Add close FAB after a delay
            // logic handled by CSS adjacency
        }

        function closeSheets() {
            document.querySelectorAll('.detail-sheet').forEach(s => s.classList.remove('active'));
            document.getElementById('backdrop').classList.remove('active');
            document.getElementById('main-action-bar').classList.remove('visible');
        }

    </script>
</body>
</html>
